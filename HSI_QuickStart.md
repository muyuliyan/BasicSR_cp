# HSI Super-Resolution Quick Start Guide

This guide provides step-by-step instructions to get started with HSI (Hyperspectral Image) super-resolution using the BasicSR framework.

## ğŸ“‹ Prerequisites

1. Python 3.7+
2. PyTorch
3. NumPy, SciPy
4. MATLAB files (.mat) or NumPy files (.npy) with HSI data

## ğŸš€ Quick Start

### Step 1: Prepare Your Dataset

1. **Organize your data** following this structure:
   ```
   datasets/your_hsi_dataset/
   â”œâ”€â”€ HR/                 # Your original high-resolution HSI data
   â”‚   â”œâ”€â”€ scene001.mat
   â”‚   â”œâ”€â”€ scene002.mat
   â”‚   â””â”€â”€ ...
   â”œâ”€â”€ LR/                 # Will be generated by preprocessing
   â”œâ”€â”€ val/HR/             # Validation data (optional)
   â””â”€â”€ test/HR/            # Test data
   ```

2. **Generate LR data** using bicubic downsampling:
   ```bash
   python scripts/hsi_bicubic_preprocessing.py \
       --input_folder datasets/your_hsi_dataset/HR \
       --output_folder datasets/your_hsi_dataset/LR \
       --scale 4 \
       --file_format mat \
       --data_key gt
   ```

### Step 2: Configure Training

1. **Update training config** (`options/train/HSI/train_HSI_SRResNet_x4.yml`):
   ```yaml
   # Set your dataset paths
   datasets:
     train:
       dataroot_gt: datasets/your_hsi_dataset/HR
       dataroot_lq: datasets/your_hsi_dataset/LR
   
   # Set spectral channels (IMPORTANT!)
   network_g:
     num_in_ch: 31   # Replace with your HSI band count
     num_out_ch: 31  # Should match num_in_ch
   ```

2. **Adjust for your GPU memory**:
   ```yaml
   datasets:
     train:
       gt_size: 64           # Reduce if out of memory
       batch_size_per_gpu: 8 # Reduce if out of memory
   ```

### Step 3: Train the Model

```bash
PYTHONPATH="./:${PYTHONPATH}" CUDA_VISIBLE_DEVICES=0 python basicsr/train.py \
    -opt options/train/HSI/train_HSI_SRResNet_x4.yml \
    --auto_resume
```

### Step 4: Test the Model

1. **Update test config** (`options/test/HSI/test_HSI_SRResNet_x4.yml`):
   ```yaml
   # Set test dataset paths
   datasets:
     test_1:
       dataroot_gt: datasets/your_hsi_dataset/test/HR
       dataroot_lq: datasets/your_hsi_dataset/test/LR
   
   # Set model path
   path:
     pretrain_network_g: experiments/your_experiment/models/net_g_latest.pth
   ```

2. **Run testing**:
   ```bash
   PYTHONPATH="./:${PYTHONPATH}" CUDA_VISIBLE_DEVICES=0 python basicsr/test.py \
       -opt options/test/HSI/test_HSI_SRResNet_x4.yml
   ```

## ğŸ“Š Available Metrics

The framework provides 5 key HSI evaluation metrics:

| Metric | Description | Better |
|--------|-------------|--------|
| **PSNR** | Peak Signal-to-Noise Ratio | Higher â†‘ |
| **SSIM** | Structural Similarity Index | Higher â†‘ |
| **SAM** | Spectral Angle Mapper | Lower â†“ |
| **ERGAS** | Global Relative Error | Lower â†“ |
| **RMSE** | Root Mean Square Error | Lower â†“ |

## ğŸ”§ Customization

### Different Spectral Bands

Common HSI datasets and their channel counts:
- **CAVE**: 31 channels
- **Harvard**: 31 channels  
- **ICVL**: 31 channels
- **Pavia University**: 103 channels
- **Pavia Centre**: 102 channels

Update `num_in_ch` and `num_out_ch` accordingly.

### Memory Optimization

If you encounter out-of-memory errors:

```yaml
# Reduce these values
datasets:
  train:
    gt_size: 32            # Smaller patches
    batch_size_per_gpu: 4  # Smaller batches
    num_worker_per_gpu: 2  # Fewer workers
```

### Different Architectures

To use RCAN instead of SRResNet:

```yaml
network_g:
  type: RCAN
  num_in_ch: 31
  num_out_ch: 31
  num_feat: 64
  num_group: 10
  num_block: 20
  squeeze_factor: 16
  upscale: 4
```

## ğŸ“ File Structure Overview

```
â”œâ”€â”€ basicsr/metrics/hsi_metrics.py        # HSI-specific metrics
â”œâ”€â”€ scripts/hsi_bicubic_preprocessing.py  # Preprocessing script
â”œâ”€â”€ options/train/HSI/                    # Training configurations
â”œâ”€â”€ options/test/HSI/                     # Testing configurations
â”œâ”€â”€ docs/HSI_DatasetPreparation.md        # Detailed documentation
â””â”€â”€ datasets/example_hsi_dataset/         # Example structure
```

## ğŸ” Testing Components

Test HSI metrics independently:
```bash
python hsi_metrics_test.py
```

Test preprocessing:
```bash
python scripts/hsi_bicubic_preprocessing.py --help
```

## ğŸ“š Documentation

- **Detailed Guide**: `docs/HSI_DatasetPreparation.md`
- **Chinese Version**: `docs/HSI_DatasetPreparation_CN.md` 
- **Configuration Help**: `options/HSI_README.md`

## âš ï¸ Common Issues

1. **Shape mismatch**: Ensure all HSI files have the same number of spectral bands
2. **Memory error**: Reduce batch size and patch size
3. **File format**: Verify .mat files contain the correct data keys
4. **Path error**: Check all dataset paths in configuration files

## ğŸ¯ Expected Results

Typical metric ranges for good HSI super-resolution:
- **PSNR**: 25-40 dB (higher is better)
- **SSIM**: 0.8-0.95 (higher is better)  
- **SAM**: 0.1-0.3 radians (lower is better)
- **ERGAS**: 5-20 (lower is better)
- **RMSE**: 5-15 (lower is better)

Good luck with your HSI super-resolution experiments! ğŸš€